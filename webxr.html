<!doctype html>
<html>
<head>
    <meta name="viewport" content="width=device-width, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0">
    <title>Hello, AR!</title>
    <!-- include three.js library -->
    <script src="js/three.js"></script>
    <!-- include jsartookit -->
    <script src="jsartoolkit5/artoolkit.min.js"></script>
    <script src="jsartoolkit5/artoolkit.api.js"></script>
    <!-- include threex.artoolkit -->
    <script src="threex/threex-artoolkitsource.js"></script>
    <script src="threex/threex-artoolkitcontext.js"></script>
    <script src="threex/threex-arbasecontrols.js"></script>
    <script src="threex/threex-armarkercontrols.js"></script>
    <!-- include GTLFLoader.js -->
    <script src="https://unpkg.com/three@0.126.0/examples/js/loaders/GLTFLoader.js"></script>
</head>

<body style='margin : 0px; overflow: hidden; font-family: Monospace;'>

<script>

    var scene, camera, renderer;
    var arToolkitSource, arToolkitContext;
    var markerRoot1;
    var model;
    
    initialize();
    animate();

    
    function initialize()
    {
        scene = new THREE.Scene();

        let ambientLight = new THREE.AmbientLight( 0xcccccc, 0.5 );
        scene.add( ambientLight );
                    
        camera = new THREE.Camera();
        scene.add(camera);

        renderer = new THREE.WebGLRenderer({
            antialias : true,
            alpha: true
        });
        renderer.setClearColor(new THREE.Color('lightgrey'), 0)
        renderer.setSize( 640, 480 );
        renderer.domElement.style.position = 'absolute'
        renderer.domElement.style.top = '0px'
        renderer.domElement.style.left = '0px'
        document.body.appendChild( renderer.domElement );

        // setup arToolkitSource
        arToolkitSource = new THREEx.ArToolkitSource({
            sourceType : 'webcam',
        });

        arToolkitSource.init(function onReady(){
            onResize()
        });

        // handle resize event
        window.addEventListener('resize', function(){
            onResize()
        });
        
        // setup arToolkitContext
        arToolkitContext = new THREEx.ArToolkitContext({
            cameraParametersUrl: 'data/camera_para.dat',
            detectionMode: 'mono'
        });
        
        arToolkitContext.init( function onCompleted(){
            camera.projectionMatrix.copy( arToolkitContext.getProjectionMatrix() );
        });

        // setup markerRoots
        markerRoot1 = new THREE.Group();
        scene.add(markerRoot1);
        let markerControls = new THREEx.ArMarkerControls(arToolkitContext, markerRoot1, {
            type: 'pattern', patternUrl: "data/kanji.patt",
        })

        // Load GTLF model
        var loader = new THREE.GLTFLoader();
        loader.load('https://immersive-web.github.io/webxr-samples/media/gltf/headset/headset.gltf', function(gltf) {
            model = gltf.scene;
            model.scale.set(0.01, 0.01, 0.01); // Adjust the scale of the model
            model.position.y = 0.5; // Adjust the position as needed
            markerRoot1.add(model);
        });
    }

    function onResize()
    {
        arToolkitSource.onResize()	
        arToolkitSource.copySizeTo(renderer.domElement)	
        if ( arToolkitContext.arController !== null )
        {
            arToolkitSource.copySizeTo(arToolkitContext.arController.canvas)	
        }	
    }

    function animate()
    {
        requestAnimationFrame(animate);
        if (arToolkitSource.ready !== false) {
            arToolkitContext.update(arToolkitSource.domElement);
        }
        renderer.render(scene, camera);
    }

</script>

</body>
</html>